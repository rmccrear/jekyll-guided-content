<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ page.title | default: site.title }}</title>
  <!-- Bulma CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.2/css/bulma.min.css">
  <!-- Custom CSS (loads after Bulma for overrides) -->
  <link rel="stylesheet" href="{{ '/assets/css/main.css' | relative_url }}">
</head>
<body>
  <!-- Mobile: Hamburger navbar -->
  <nav class="navbar is-hidden-desktop" role="navigation" aria-label="main navigation">
    <div class="navbar-brand">
      <a class="navbar-item" href="{{ '/' | relative_url }}">
        {{ site.data.course.title | default: page.title | default: site.title | default: 'Course' }}
      </a>
      <!-- Theme Toggle Button (Mobile) -->
      <a role="button" class="navbar-item is-hidden-desktop theme-toggle" aria-label="toggle theme">
        <span class="icon">
          <span class="theme-icon-light">ðŸŒž</span>
          <span class="theme-icon-dark" style="display: none;">ðŸŒ™</span>
        </span>
      </a>
      <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="toc-menu">
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
      </a>
    </div>
    <div id="toc-menu" class="navbar-menu">
      <div class="navbar-start">
        <div class="navbar-item">
          <aside class="menu" id="mobile-toc">
            <p class="menu-label">Lessons</p>
            <ul class="menu-list" id="mobile-toc-list">
              {% if site.data.course.lessons %}
                {% assign sorted_lessons = site.data.course.lessons | sort: "order" %}
                {% for lesson_data in sorted_lessons %}
                  {% assign lesson_path = lesson_data.path | append: "/index.md" %}
                  {% assign lesson_page = site.pages | where: "path", lesson_path | first %}
                  {% if lesson_page %}
                    <li><a href="{{ lesson_page.url | relative_url }}">{{ lesson_data.title | default: lesson_page.title }}</a></li>
                  {% endif %}
                {% endfor %}
              {% endif %}
            </ul>
          </aside>
        </div>
      </div>
    </div>
  </nav>

  <div class="columns is-gapless" style="margin-top: 0;">
    <!-- Desktop: Sidebar column -->
    <aside class="column is-narrow is-hidden-touch" id="desktop-sidebar">
      <div class="section" style="padding: 1.5rem;">
        <!-- Theme Toggle Button (Desktop Sidebar) -->
        <button class="button is-light is-small is-fullwidth theme-toggle" style="margin-bottom: 1rem;">
          <span class="icon">
            <span class="theme-icon-light">ðŸŒž</span>
            <span class="theme-icon-dark" style="display: none;">ðŸŒ™</span>
          </span>
          <span>Toggle Theme</span>
        </button>

        <aside class="menu">
          <p class="menu-label">Lessons</p>
          <ul class="menu-list" id="desktop-toc-list">
            {% if site.data.course.lessons %}
              {% assign sorted_lessons = site.data.course.lessons | sort: "order" %}
              {% for lesson_data in sorted_lessons %}
                {% assign lesson_path = lesson_data.path | append: "/index.md" %}
                {% assign lesson_page = site.pages | where: "path", lesson_path | first %}
                {% if lesson_page %}
                  <li><a href="{{ lesson_page.url | relative_url }}">{{ lesson_data.title | default: lesson_page.title }}</a></li>
                {% endif %}
              {% endfor %}
            {% endif %}
          </ul>
        </aside>
      </div>
    </aside>
    
    <!-- Main content column -->
    <main class="column">
      <section class="section">
        <div class="container">
          <!-- Course Header -->
          <h1 class="title is-1">{{ site.data.course.title | default: page.title | default: 'Course' }}</h1>
          {% assign course_description = site.data.course.description | default: page.description %}
          {% if course_description %}
            <p class="subtitle is-4">{{ course_description }}</p>
          {% endif %}
          
          <!-- Course Content -->
          <div class="content">
            {{ content }}
          </div>
          
          <!-- Lesson Cards Grid -->
          <div class="columns is-multiline" style="margin-top: 2rem;">
            {% if site.data.course.lessons %}
              {% assign sorted_lessons = site.data.course.lessons | sort: "order" %}
              {% for lesson_data in sorted_lessons %}
                {% assign lesson_path = lesson_data.path | append: "/index.md" %}
                {% assign lesson_page = site.pages | where: "path", lesson_path | first %}
                {% if lesson_page %}
                  <div class="column is-one-third">
                    <div class="card">
                      <div class="card-content">
                        <p class="title is-5">
                          <a href="{{ lesson_page.url | relative_url }}">{{ lesson_data.title | default: lesson_page.title }}</a>
                        </p>
                        {% assign lesson_description = lesson_data.description | default: lesson_page.description %}
                        {% if lesson_description %}
                          <p class="subtitle is-6">{{ lesson_description }}</p>
                        {% endif %}
                        <div class="content">
                          {% if lesson_page.excerpt %}
                            {{ lesson_page.excerpt | markdownify | strip_html | truncatewords: 30 }}
                          {% endif %}
                        </div>
                      </div>
                      <footer class="card-footer">
                        <a href="{{ lesson_page.url | relative_url }}" class="card-footer-item">Start Lesson â†’</a>
                      </footer>
                    </div>
                  </div>
                {% endif %}
              {% endfor %}
            {% endif %}
          </div>
        </div>
      </section>
    </main>
  </div>
  
  <!-- Hamburger menu toggle -->
  <script>
    (function() {
      const burger = document.querySelector('.navbar-burger');
      const menu = document.getElementById('toc-menu');
      
      if (burger && menu) {
        burger.addEventListener('click', function() {
          burger.classList.toggle('is-active');
          menu.classList.toggle('is-active');
        });
      }
    })();
  </script>

  <!-- Theme Toggle Script -->
  <script>
    (function() {
      const themeToggles = document.querySelectorAll('.theme-toggle');
      const html = document.documentElement;
      const lightIcons = document.querySelectorAll('.theme-icon-light');
      const darkIcons = document.querySelectorAll('.theme-icon-dark');

      // Function to set theme
      function setTheme(theme) {
        html.setAttribute('data-theme', theme);
        localStorage.setItem('theme', theme);
        
        // Update icons
        if (theme === 'dark') {
          lightIcons.forEach(icon => icon.style.display = 'none');
          darkIcons.forEach(icon => icon.style.display = 'inline');
        } else {
          lightIcons.forEach(icon => icon.style.display = 'inline');
          darkIcons.forEach(icon => icon.style.display = 'none');
        }
      }

      // Check for saved preference or system preference
      const savedTheme = localStorage.getItem('theme');
      const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
      
      // Initial set
      setTheme(savedTheme || systemTheme);

      // Add click handlers
      themeToggles.forEach(toggle => {
        toggle.addEventListener('click', () => {
          const currentTheme = html.getAttribute('data-theme');
          const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
          setTheme(newTheme);
        });
      });
    })();
  </script>
</body>
</html>